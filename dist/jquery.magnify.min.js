/*!
 *  ___  ___  _____   ______  __   __ _____ ______ __    __
 * |   \/   |/  _  \ /  __  \|  \ |  |_   _|   ___|  \  /  |
 * |        |  / \  |  |  \__|   \|  | | | |  |__  \  \/  /
 * |  |\/|  |  |_|  |  |  ___        | | | |   __|  \    /
 * |  |  |  |   _   |  \_/   |  |\   |_| |_|  |      |  |
 * |__|  |__|__| |__|\____/|_|__| \__|_____|__|      |__|
 *
 * jquery.magnify - v1.0.0
 * A jQuery plugin to view images just like in windows
 * https://github.com/nzbin/magnify#readme
 *
 * Copyright (c) 2017 nzbin
 * Released under the MIT License
 *
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(i){return t(i).attr("data-src")?t(i).attr("data-src"):t(i).attr("href")}function e(t){var i=t.match(/\d+/g);return parseFloat(i[0])}function o(t,i,e,o){var a=o?t.h:t.w,n=o?t.w:t.h;(n>i.h||a>i.w)&&e.addClass("is-grab"),n<=i.h&&a<=i.w&&e.removeClass("is-grab")}function a(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}var n=t(window),s=t(document),h=a()?"touchstart":"mousedown",l=a()?"touchmove":"mousemove",r=a()?"touchend":"mouseup",g=".magnify",f={draggable:!0,resizable:!0,movable:!0,keyboard:!0,title:!0,modalWidth:320,modalHeight:320,fixedContent:!0,fixedModalSize:!1,initMaximized:!1,gapThreshold:.02,ratioThreshold:.1,minRatio:.1,maxRatio:16,headToolbar:["maximize","close"],footToolbar:["zoomIn","zoomOut","prev","fullscreen","next","actualSize","rotateRight"],icons:{minimize:"fa fa-window-minimize",maximize:"fa fa-window-maximize",close:"fa fa-close",zoomIn:"fa fa-search-plus",zoomOut:"fa fa-search-minus",prev:"fa fa-arrow-left",next:"fa fa-arrow-right",fullscreen:"fa fa-photo",actualSize:"fa fa-arrows-alt",rotateLeft:"fa fa-rotate-left",rotateRight:"fa fa-rotate-right"},i18n:{minimize:"minimize",maximize:"maximize",close:"close",zoomIn:"zoom-in(+)",zoomOut:"zoom-out(-)",prev:"prev(←)",next:"next(→)",fullscreen:"fullscreen",actualSize:"actual-size(Ctrl+Alt+0)",rotateLeft:"rotate-left(Ctrl+,)",rotateRight:"rotate-right(Ctrl+.)"},multiInstances:!0,initEvent:"click",initAnimation:!0,fixedModalPos:!1,zIndex:1090,dragHandle:!1,callbacks:{beforeOpen:t.noop,opened:t.noop,beforeClose:t.noop,closed:t.noop,beforeChange:t.noop,changed:t.noop}},d={isMoving:!1,isResizing:!1,zIndex:f.zIndex},m=null,c=function(i,e){this.options=t.extend(!0,{},f,e),e&&t.isArray(e.footToolbar)&&(this.options.footToolbar=e.footToolbar),e&&t.isArray(e.headToolbar)&&(this.options.headToolbar=e.headToolbar),this.$el=t(i),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(i,this.options)};c.prototype={init:function(e,o){var a=i(e);this.groupName=null;var n=t(e).attr("data-group"),h=s.find('[data-group="'+n+'"]');void 0!==n?(this.groupName=n,this.getImgGroup(h,a)):this.getImgGroup(m.not("[data-group]"),a),this.open(),this.loadImg(a),o.draggable&&this.draggable(this.$magnify,this.dragHandle,".magnify-button"),o.movable&&this.movable(this.$stage,this.$image),o.resizable&&this.resizable(this.$magnify,this.$stage,this.$image,o.modalWidth,o.modalHeight)},_creatBtns:function(i,e){var o="";return t.each(i,function(t,i){o+=e[i]}),o},_creatTitle:function(){return this.options.title?'<div class="magnify-title"></div>':""},creatDOM:function(){var t={minimize:'<button class="magnify-button magnify-button-minimize" title="'+this.options.i18n.minimize+'">                      <i class="'+this.options.icons.minimize+'" aria-hidden="true"></i>                    </button>',maximize:'<button class="magnify-button magnify-button-maximize" title="'+this.options.i18n.maximize+'">                      <i class="'+this.options.icons.maximize+'" aria-hidden="true"></i>                    </button>',close:'<button class="magnify-button magnify-button-close" title="'+this.options.i18n.close+'">                      <i class="'+this.options.icons.close+'" aria-hidden="true"></i>                    </button>',zoomIn:'<button class="magnify-button magnify-button-zoom-in" title="'+this.options.i18n.zoomIn+'">                      <i class="'+this.options.icons.zoomIn+'" aria-hidden="true"></i>                    </button>',zoomOut:'<button class="magnify-button magnify-button-zoom-out" title="'+this.options.i18n.zoomOut+'">                      <i class="'+this.options.icons.zoomOut+'" aria-hidden="true"></i>                    </button>',prev:'<button class="magnify-button magnify-button-prev" title="'+this.options.i18n.prev+'">                      <i class="'+this.options.icons.prev+'" aria-hidden="true"></i>                    </button>',next:'<button class="magnify-button magnify-button-next" title="'+this.options.i18n.next+'">                      <i class="'+this.options.icons.next+'" aria-hidden="true"></i>                    </button>',fullscreen:'<button class="magnify-button magnify-button-fullscreen" title="'+this.options.i18n.fullscreen+'">                      <i class="'+this.options.icons.fullscreen+'" aria-hidden="true"></i>                    </button>',actualSize:'<button class="magnify-button magnify-button-actual-size" title="'+this.options.i18n.actualSize+'">                      <i class="'+this.options.icons.actualSize+'" aria-hidden="true"></i>                    </button>',rotateLeft:'<button class="magnify-button magnify-button-rotate-left" title="'+this.options.i18n.rotateLeft+'">                      <i class="'+this.options.icons.rotateLeft+'" aria-hidden="true"></i>                    </button>',rotateRight:'<button class="magnify-button magnify-button-rotate-right" title="'+this.options.i18n.rotateRight+'">                      <i class="'+this.options.icons.rotateRight+'" aria-hidden="true"></i>                    </button>'};return'<div class="magnify-modal">                        <div class="magnify-header">                          <div class="magnify-toolbar magnify-head-toolbar">'+this._creatBtns(this.options.headToolbar,t)+"                          </div>"+this._creatTitle()+'                        </div>                        <div class="magnify-stage">                          <img class="magnify-image" src="" alt="" />                        </div>                        <div class="magnify-footer">                          <div class="magnify-toolbar magnify-foot-toolbar">'+this._creatBtns(this.options.footToolbar,t)+"                          </div>                        </div>                      </div>"},build:function(){var i=this.creatDOM(),e=t(i);this.$magnify=e,this.$header=e.find(".magnify-header"),this.$headToolbar=e.find(".magnify-head-toolbar"),this.$footer=e.find(".magnify-footer"),this.$footToolbar=e.find(".magnify-foot-toolbar"),this.$stage=e.find(".magnify-stage"),this.$title=e.find(".magnify-title"),this.$image=e.find(".magnify-image"),this.$close=e.find(".magnify-button-close"),this.$maximize=e.find(".magnify-button-maximize"),this.$minimize=e.find(".magnify-button-minimize"),this.$zoomIn=e.find(".magnify-button-zoom-in"),this.$zoomOut=e.find(".magnify-button-zoom-out"),this.$actualSize=e.find(".magnify-button-actual-size"),this.$fullscreen=e.find(".magnify-button-fullscreen"),this.$rotateLeft=e.find(".magnify-button-rotate-left"),this.$rotateRight=e.find(".magnify-button-rotate-right"),this.$prev=e.find(".magnify-button-prev"),this.$next=e.find(".magnify-button-next"),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$magnify.css("z-index",d.zIndex),this.options.dragHandle&&".magnify-modal"!==this.options.dragHandle?this.dragHandle=this.$magnify.find(this.options.dragHandle):this.dragHandle=this.$magnify},open:function(){if(this.options.multiInstances||t(".magnify-modal").eq(0).remove(),!t(".magnify-modal").length&&this.options.fixedContent&&(t("html").css({overflow:"hidden"}),document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight))){var i=function(){var t=document.createElement("div");t.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(t);var i=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),i}();i&&t("html").css({"padding-right":i})}this.build(),this._triggerHook("beforeOpen",this.$el),t("body").append(this.$magnify),this.addEvents(),this.setModalPos(this.$magnify),this._triggerHook("opened",this.$el)},close:function(i){this._triggerHook("beforeClose",this.$el),this.$magnify.remove(),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0;var e=!t(".magnify-modal").length;e&&this.options.fixedContent&&t("html").css({overflow:"","padding-right":""}),e&&this.options.multiInstances&&(d.zIndex=this.options.zIndex),t(".magnify-modal").length||(s.off("keydown.magnify"),n.off("resize.magnify")),this._triggerHook("closed",this.$el)},setModalPos:function(t){var i=n.width(),e=n.height(),o=s.scrollLeft(),a=s.scrollTop(),h=this.options.modalWidth,l=this.options.modalHeight;this.options.initMaximized?(t.addClass("magnify-maximize"),t.css({width:"100%",height:"100%",left:0,top:0}),this.isOpened=!0,this.isMaximized=!0):t.css({width:h,height:l,left:(i-h)/2+o+"px",top:(e-l)/2+a+"px"})},setModalSize:function(t){var i=this,o=n.width(),a=n.height(),h=s.scrollLeft(),l=s.scrollTop(),r={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},g=t.width+e(r.left)+e(r.right)+e(r.borderLeft)+e(r.borderRight),f=t.height+e(r.top)+e(r.bottom)+e(r.borderTop)+e(r.borderBottom),d=(this.options.gapThreshold>0?this.options.gapThreshold:0)+1,m=Math.min(o/(g*d),a/(f*d),1),c=Math.max(g*m,this.options.modalWidth),p=Math.max(f*m,this.options.modalHeight),u={width:(c=this.options.fixedModalSize?this.options.modalWidth:Math.round(c))+"px",height:(p=this.options.fixedModalSize?this.options.modalHeight:Math.round(p))+"px",left:(o-c)/2+h+"px",top:(a-p)/2+l+"px"};this.options.initAnimation?this.$magnify.animate(u,function(){i.setImageSize(t)}):(this.$magnify.css(u),this.setImageSize(t)),this.isOpened=!0},setImageSize:function(i){var e={w:this.$stage.width(),h:this.$stage.height()},a=1;a=this.isRotated?Math.min(e.w/i.height,e.h/i.width,1):Math.min(e.w/i.width,e.h/i.height,1),this.$image.css({width:Math.ceil(i.width*a)+"px",height:Math.ceil(i.height*a)+"px",left:(e.w-Math.ceil(i.width*a))/2+"px",top:(e.h-Math.ceil(i.height*a))/2+"px"}),t.extend(this.imageData,{width:i.width*a,height:i.height*a,left:(e.w-i.width*a)/2,top:(e.h-i.height*a)/2}),o({w:this.$image.width(),h:this.$image.height()},{w:this.$stage.width(),h:this.$stage.height()},this.$stage,this.isRotated),this.$magnify.find(".magnify-loader").remove(),this.options.initAnimation&&this.$image.fadeIn()},loadImg:function(t){var i=this;this.$magnify.append('<div class="magnify-loader"></div>'),this.options.initAnimation&&this.$image.hide(),this.$image.attr("src",t),function(t,i,e){var o=new Image;o.onload=function(){i(o)},o.onerror=function(){e(o)},o.src=t}(t,function(t){i.imageData={originalWidth:t.width,originalHeight:t.height},i.isMaximized||i.isOpened&&i.options.fixedModalPos?i.setImageSize(t):i.setModalSize(t),i.$stage.removeClass("stage-ready"),i.$image.removeClass("image-ready")},function(){i.$magnify.find(".magnify-loader").remove()}),this.options.title&&this.setImgTitle(t)},getImgGroup:function(e,o){var a=this;a.groupData=[],t(e).each(function(e,n){var s=i(this);a.groupData.push({src:s,caption:t(this).attr("data-caption")}),o===s&&(a.groupIndex=e)})},setImgTitle:function(t){var i=this.groupIndex,e=(e=this.groupData[i].caption)||function(t){return t.replace(/^.*?\/*([^/?]*)\.[a-z]+(\?.+|$)/gi,"$1")}(t);this.$title.text(e)},jump:function(t){this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)},jumpTo:function(t){(t%=this.groupData.length)>=0?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this._triggerHook("beforeChange",t),this.loadImg(this.groupData[t].src),this._triggerHook("changed",t)},wheel:function(t){t.preventDefault();var i=1;t.originalEvent.deltaY?i=t.originalEvent.deltaY>0?1:-1:t.originalEvent.wheelDelta?i=-t.originalEvent.wheelDelta/120:t.originalEvent.detail&&(i=t.originalEvent.detail>0?1:-1);var e=-i*this.options.ratioThreshold,o={x:t.originalEvent.clientX-this.$stage.offset().left+s.scrollLeft(),y:t.originalEvent.clientY-this.$stage.offset().top+s.scrollTop()};this.zoom(e,o,t)},zoom:function(t,i,e){(t=t<0?1/(1-t):1+t)>.95&&t<1.05&&(t=1),t=this.$image.width()/this.imageData.originalWidth*t,t=Math.max(t,this.options.minRatio),t=Math.min(t,this.options.maxRatio),this.zoomTo(t,i,e)},zoomTo:function(i,e,a){var n=this.$image,s=this.$stage,h={w:this.imageData.width,h:this.imageData.height,x:this.imageData.left,y:this.imageData.top},l={w:s.width(),h:s.height(),x:s.offset().left,y:s.offset().top},r=this.imageData.originalWidth*i,g=this.imageData.originalHeight*i,f=e.x-(e.x-h.x)/h.w*r,d=e.y-(e.y-h.y)/h.h*g,m=this.isRotated?(r-g)/2:0,c=this.isRotated?g:r,p=this.isRotated?r:g,u=l.w-r,y=l.h-g;
// The conditions with image rotate 90 degree drive me crazy alomst!
d=p<=l.h?(l.h-g)/2:d>m?m:d>y-m?d:y-m,f=c<=l.w?(l.w-r)/2:f>-m?-m:f>u+m?f:u+m,n.css({width:Math.round(r)+"px",height:Math.round(g)+"px",left:Math.round(f)+"px",top:Math.round(d)+"px"}),t.extend(this.imageData,{width:r,height:g,left:f,top:d}),o({w:Math.round(c),h:Math.round(p)},{w:l.w,h:l.h},this.$stage)},rotate:function(t){this.rotateAngle=this.rotateAngle+t,this.rotateAngle/90%2==0?this.isRotated=!1:this.isRotated=!0,this.rotateTo(this.rotateAngle)},rotateTo:function(t){this.$image.css({transform:"rotate("+t+"deg)"}),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight}),this.$stage.removeClass("is-grab")},resize:function(){var t=this;return function(t,i){var e=null;return function(){var o=this,a=arguments;clearTimeout(e),e=setTimeout(function(){t.apply(o,a)},i)}}(function(){t.isOpened&&(t.isMaximized?t.setImageSize({width:t.imageData.originalWidth,height:t.imageData.originalHeight}):t.setModalSize({width:t.imageData.originalWidth,height:t.imageData.originalHeight}))},500)},maximize:function(){this.isMaximized?(this.$magnify.removeClass("magnify-maximize"),this.$magnify.css({width:this.modalData.width?this.modalData.width:this.options.modalWidth,height:this.modalData.height?this.modalData.height:this.options.modalHeight,left:this.modalData.left?this.modalData.left:(n.width()-this.options.modalWidth)/2+s.scrollLeft(),top:this.modalData.top?this.modalData.top:(n.height()-this.options.modalHeight)/2+s.scrollTop()}),this.isMaximized=!1):(this.modalData={width:this.$magnify.width(),height:this.$magnify.height(),left:this.$magnify.offset().left,top:this.$magnify.offset().top},this.$magnify.addClass("magnify-maximize"),this.$magnify.css({width:"100%",height:"100%",left:0,top:0}),this.isMaximized=!0),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight})},fullscreen:function(){!function(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}(this.$magnify[0])},keydown:function(t){if(!this.options.keyboard)return!1;var i=t.keyCode||t.which||t.charCode,e=t.ctrlKey||t.metaKey,o=t.altKey||t.metaKey;switch(i){case 37:this.jump(-1);break;case 39:this.jump(1);break;case 187:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 189:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 61:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 173:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 48:e&&o&&this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 188:e&&this.rotate(-90);break;case 190:e&&this.rotate(90)}},addEvents:function(){var t=this;this.$close.off("click.magnify").on("click.magnify",function(i){t.close()}),this.$stage.off("wheel mousewheel DOMMouseScroll.magnify").on("wheel mousewheel DOMMouseScroll.magnify",function(i){t.wheel(i)}),this.$zoomIn.off("click.magnify").on("click.magnify",function(i){t.zoom(3*t.options.ratioThreshold,{x:t.$stage.width()/2,y:t.$stage.height()/2},i)}),this.$zoomOut.off("click.magnify").on("click.magnify",function(i){t.zoom(3*-t.options.ratioThreshold,{x:t.$stage.width()/2,y:t.$stage.height()/2},i)}),this.$actualSize.off("click.magnify").on("click.magnify",function(i){t.zoomTo(1,{x:t.$stage.width()/2,y:t.$stage.height()/2},i)}),this.$prev.off("click.magnify").on("click.magnify",function(){t.jump(-1)}),this.$fullscreen.off("click.magnify").on("click.magnify",function(){t.fullscreen()}),this.$next.off("click.magnify").on("click.magnify",function(){t.jump(1)}),this.$rotateLeft.off("click.magnify").on("click.magnify",function(){t.rotate(-90)}),this.$rotateRight.off("click.magnify").on("click.magnify",function(){t.rotate(90)}),this.$maximize.off("click.magnify").on("click.magnify",function(){t.maximize()}),s.off("keydown.magnify").on("keydown.magnify",function(i){t.keydown(i)}),n.on("resize.magnify",t.resize())},_triggerHook:function(i,e){this.options.callbacks[i]&&this.options.callbacks[i].apply(this,t.isArray(e)?e:[e])}},t.fn.magnify=function(i){m=t(this);for(var e in i)"string"!=typeof i[e]||isNaN(i[e])||(i[e]=parseFloat(i[e]));var o=t.extend(!0,{},f,i);return d.zIndex=o.zIndex,"string"==typeof i||("dblclick"===o.initEvent&&m.off("click.magnify").on("click.magnify",function(t){t.preventDefault(),t.stopPropagation()}),m.off(o.initEvent+g).on(o.initEvent+g,function(e){e.preventDefault(),e.stopPropagation(),t(this).data("magnify",new c(this,i))})),m},s.on("click.magnify","[data-magnify]",function(i){m=t("[data-magnify]"),i.preventDefault(),t(this).data("magnify",new c(this,f))});t.extend(c.prototype,{draggable:function(i,e,o){var a=this,n=!1,f=0,m=0,c=0,p=0,u=function(e){if((e=e||window.event).preventDefault(),n&&!d.isMoving&&!d.isResizing&&!a.isMaximized){var o="touchmove"===e.type?e.originalEvent.targetTouches[0].pageX:e.clientX,s="touchmove"===e.type?e.originalEvent.targetTouches[0].pageY:e.clientY,h=o-f,l=s-m;t(i).css({left:h+c+"px",top:l+p+"px"})}},y=function(t){s.off(l+g,u).off(r+g,y),n=!1};t(e).on(h+g,function(e){if(e=e||window.event,a.options.multiInstances&&i.css("z-index",++d.zIndex),t(e.target).closest(o).length)return!0;n=!0,f="touchstart"===e.type?e.originalEvent.targetTouches[0].pageX:e.clientX,m="touchstart"===e.type?e.originalEvent.targetTouches[0].pageY:e.clientY,c=t(i).offset().left,p=t(i).offset().top,s.on(l+g,u).on(r+g,y)})}});t.extend(c.prototype,{movable:function(i,e){var o=this,a=!1,n=0,f=0,m=0,c=0,p=0,u=0,y=0,x=function(i){if((i=i||window.event).preventDefault(),a){var s="touchmove"===i.type?i.originalEvent.targetTouches[0].pageX:i.clientX,h="touchmove"===i.type?i.originalEvent.targetTouches[0].pageY:i.clientY,l=s-n,r=h-f,g=l+m,d=r+c;u>0?r+c>y?d=y:r+c<-u+y&&(d=-u+y):d=c,p>0?l+m>-y?g=-y:l+m<-p-y&&(g=-p-y):g=m,t(e).css({left:g+"px",top:d+"px"}),t.extend(o.imageData,{left:g,top:d})}},w=function(i){s.off(l+g,x).off(r+g,w),a=!1,d.isMoving=!1,t("html,body,.magnify-modal,.magnify-stage,.magnify-button,.magnify-resizable-handle").removeClass("is-grabbing")};t(i).on(h+g,function(h){(h=h||window.event).preventDefault();var b=t(e).width(),v=t(e).height(),z=t(i).width(),$=t(i).height();n="touchstart"===h.type?h.originalEvent.targetTouches[0].pageX:h.clientX,f="touchstart"===h.type?h.originalEvent.targetTouches[0].pageY:h.clientY,y=o.isRotated?(b-v)/2:0,p=o.isRotated?v-z:b-z,u=o.isRotated?b-$:v-$,a=p>0||u>0,d.isMoving=p>0||u>0,m=t(e).position().left-y,c=t(e).position().top+y,i.hasClass("is-grab")&&t("html,body,.magnify-modal,.magnify-stage,.magnify-button,.magnify-resizable-handle").addClass("is-grabbing"),s.on(l+g,x).on(r+g,w)})}});t.extend(c.prototype,{resizable:function(i,e,a,n,f){var m=this,c=t('<div class="magnify-resizable-handle magnify-resizable-handle-e"></div>'),p=t('<div class="magnify-resizable-handle magnify-resizable-handle-w"></div>'),u=t('<div class="magnify-resizable-handle magnify-resizable-handle-s"></div>'),y=t('<div class="magnify-resizable-handle magnify-resizable-handle-n"></div>'),x=t('<div class="magnify-resizable-handle magnify-resizable-handle-se"></div>'),w=t('<div class="magnify-resizable-handle magnify-resizable-handle-sw"></div>'),b=t('<div class="magnify-resizable-handle magnify-resizable-handle-ne"></div>'),v=t('<div class="magnify-resizable-handle magnify-resizable-handle-nw"></div>'),z={e:c,s:u,se:x,n:y,w:p,nw:v,ne:b,sw:w};t(i).append(c,p,u,y,x,w,b,v);var $=!1,M=0,T=0,D={w:0,h:0,l:0,t:0},k={w:0,h:0,l:0,t:0},I={w:0,h:0,l:0,t:0},R=0,H=0,E=0,C="",S=function(o,n){(n=n||window.event).preventDefault(),$=!0,d.isResizing=!0,M="touchstart"===n.type?n.originalEvent.targetTouches[0].pageX:n.clientX,T="touchstart"===n.type?n.originalEvent.targetTouches[0].pageY:n.clientY,D={w:t(i).width(),h:t(i).height(),l:t(i).offset().left,t:t(i).offset().top},k={w:t(e).width(),h:t(e).height(),l:t(e).offset().left,t:t(e).offset().top},I={w:t(a).width(),h:t(a).height(),l:t(a).position().left,t:t(a).position().top},R=m.isRotated?(I.w-I.h)/2:0,H=m.isRotated?I.h:I.w,E=m.isRotated?I.w:I.h,C=o,t("html,body,.magnify-modal,.magnify-stage,.magnify-button").css("cursor",o+"-resize"),s.on(l+g,O).on(r+g,W)},O=function(e){if((e=e||window.event).preventDefault(),$&&!m.isMaximized){var o="touchmove"===e.type?e.originalEvent.targetTouches[0].pageX:e.clientX,s="touchmove"===e.type?e.originalEvent.targetTouches[0].pageY:e.clientY,h=o-M,l=s-T,r=function(t,i,e){var o=-i+D.w>n?i+D.l:D.l+D.w-n,a=-e+D.h>f?e+D.t:D.t+D.h-f;return{e:{width:Math.max(i+D.w,n)+"px"},s:{height:Math.max(e+D.h,f)+"px"},se:{width:Math.max(i+D.w,n)+"px",height:Math.max(e+D.h,f)+"px"},w:{width:Math.max(-i+D.w,n)+"px",left:o+"px"},n:{height:Math.max(-e+D.h,f)+"px",top:a+"px"},nw:{width:Math.max(-i+D.w,n)+"px",height:Math.max(-e+D.h,f)+"px",top:a+"px",left:o+"px"},ne:{width:Math.max(i+D.w,n)+"px",height:Math.max(-e+D.h,f)+"px",top:a+"px"},sw:{width:Math.max(-i+D.w,n)+"px",height:Math.max(e+D.h,f)+"px",left:o+"px"}}[t]}(C,h,l);t(i).css(r);var g=function(i,e,o){var s=e+D.w>n?k.w-H+e-R:n-(D.w-k.w)-H-R,h=o+D.h>f?k.h-E+o+R:f-(D.h-k.h)-E+R,l=-e+D.w>n?k.w-H-e-R:n-(D.w-k.w)-H-R,r=-o+D.h>f?k.h-E-o+R:f-(D.h-k.h)-E+R,g=(s>0?t(a).position().left:t(a).position().left<0?t(a).position().left:0)-R,d=(h>0?t(a).position().top:t(a).position().top<0?t(a).position().top:0)+R,m=(l>0?t(a).position().left:t(a).position().left<0?t(a).position().left:0)-R,c=(r>0?t(a).position().top:t(a).position().top<0?t(a).position().top:0)+R;return{e:{left:s>=-R?(s-R)/2+"px":g>s?g+"px":s+"px"},s:{top:h>=R?(h+R)/2+"px":d>h?d+"px":h+"px"},se:{top:h>=R?(h+R)/2+"px":d>h?d+"px":h+"px",left:s>=-R?(s-R)/2+"px":g>s?g+"px":s+"px"},w:{left:l>=-R?(l-R)/2+"px":m>l?m+"px":l+"px"},n:{top:r>=R?(r+R)/2+"px":c>r?c+"px":r+"px"},nw:{top:r>=R?(r+R)/2+"px":c>r?c+"px":r+"px",left:l>=-R?(l-R)/2+"px":m>l?m+"px":l+"px"},ne:{top:r>=R?(r+R)/2+"px":c>r?c+"px":r+"px",left:s>=-R?(s-R)/2+"px":g>s?g+"px":s+"px"},sw:{top:h>=R?(h+R)/2+"px":d>h?d+"px":h+"px",left:l>=-R?(l-R)/2+"px":m>l?m+"px":l+"px"}}[i]}(C,h,l);t(a).css(g)}},W=function(i){s.off(l+g,O).off(r+g,W),d.isResizing&&o({w:H,h:E},{w:t(e).width(),h:t(e).height()},e),$=!1,d.isResizing=!1,t("html,body,.magnify-modal,.magnify-stage,.magnify-button").css("cursor","")};t.each(z,function(t,i){i.on(h+g,function(i){S(t,i)})})}})});